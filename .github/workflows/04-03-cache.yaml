name: Caching

on:
    workflow_dispatch:

jobs:
    actions-cache:
        name: Demo cache
        runs-on: ubuntu-24.04
        steps:
            # Attempt to restore (misses on first run)
            - name: Restore cache
              id: demo-cache
              uses: actions/cache@v6
              with:
                path: demo-cache
                key: demo-cache-v1

            # Populate directory only on miss
            - name: Populate cache on miss
              if: steps.demo-cache.outputs.cache-hit != 'true'
              run: |
                echo "Cache miss! Populating cache..."
                mkdir -p demo-cache
                echo "This is some cached data." > demo-cache/data.txt

            # Save cache only if we generated new content
            - name: Save cache on miss
              if: steps.demo-cache.outputs.cache-hit != 'true'
              uses: actions/cache@v6
              with:
                path: demo-cache
                key: demo-cache-v1
            
            - name: Verify cache status
              run: |
                echo "cache-hit? => ${{ steps.demo-cache.outputs.cache-hit }}"
                cat demo-cache/data.txt